<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
//TODO: Modify this into https://www.w3schools.com/tags/tag_fieldset.asp for better graphics

function addRadioBool(name){
	for (var i = 0; i< name.length ; i++){
		var id = "radio_"+name[i];
		$("#mods").after("<div id='"+id+"'>"+name[i]);
		$("#"+id).append("<br>");
		//Create 2 buttons for every option (T/F)
		for (var j = 0 ; j < 2 ; j++){
			var radioInput = document.createElement('input');
			var text = document.createElement('label');
			text.innerHTML = j%2 ? 'False' : 'True';
			radioInput.setAttribute('type', 'radio');
			radioInput.setAttribute('name', name[i]); //Category
			radioInput.setAttribute('id', name[i]+j);
			radioInput.setAttribute('value', text.innerHTML);
			$("#"+id).append(text);
			$("#"+id).append(radioInput);
		}
		$("#mods").after("</div>");
		$("#mods").after("<br>");
	}
	$("#mods").after("<br>");
	$("#confirm").before("<br>");
}
var dict = {"Camera":"/camera/"}

function parsetoROS(){
	var ros = '<launch> \n \t <arg name="veh" default="$(env VEHICLE_NAME)"/> \n ';
	//For demos, using a master file
	ros += '\t <include file="$(find duckietown_demos)/launch/master.launch"> \n ';
	$('input:radio:checked').each(function() {
		ros += '\t \t <arg name="'+dict["Camera"]+jQuery(this).attr('name') + '" value="' + jQuery(this).attr('value')+'" /> \n';
	});
	ros += '\t </include>';
	ros += '</launch>';
	//alert(ros);
	console.log(ros);
	writeTextFile("Camera.launch", ros);
}
function parsetoJava(){
	//TODO: Take file and get the content
	var temp = '<launch> \n \t <arg name="veh" default="$(env VEHICLE_NAME)"/> \n \t <include file="$(find duckietown_demos)/launch/master.launch"> \n \t \t <arg name="/camera/local" value="True" /> \n \t \t <arg name="/camera/raw" value="False" /> \n \t </include> \n </launch>';
	var res = temp.split("\n");
	var args = {};
	for (var i = 0; i<res.length;i++){
		if (res[i].indexOf('<arg')!== -1){
			var split = res[i].split(" ");
			var arg_name = "";
			for (var j = 0; j<split.length;j++){
				if (split[j].indexOf('name=')!== -1){
					arg_name = split[j].slice(6,split[j].length-1);
				}
				if (split[j].indexOf('value=')!== -1){
					var arg_val = split[j].slice(7,split[j].length-1);
					args[arg_name]= arg_val;
					arg_name = "";
				}

			}
		}
	}
	
	var javatext="";
	for (var key in args){
		if (args.hasOwnProperty(key)) {
			var getParamPos = key.indexOf(dict["Camera"]);
			if (getParamPos !== -1){
				var flag_name = key.slice(getParamPos + dict["Camera"].length);
				javatext += "private boolean " + flag_name + " = " + args[key] + " \n";
			}
		}
	}
	
	console.log(javatext);

}
function getAllIndexes(arr, val) {
    var indexes = [], i;
    for(i = 0; i < arr.length; i++)
        if (arr[i] === val)
            indexes.push(i);
    return indexes;
}
//PHP or NODE.JS to r/w
function writeTextFile(filepath, output) {
	//sw = new StreamWriter("TestFile.txt");
    // Add some text to the file.
    //sw.Write("This is the ");
	//var txtFile = new File(filepath);
	//txtFile.open("w"); //
	//txtFile.writeln(output);
	//txtFile.close();
}

$(document).ready(function(){
    $.ajax({
                    url: "Camera.java",
                    dataType: "text",
                    success: function (data) {
							var name = [];
							var j = 0;
							data = data.replace(/\n/g,'');
							data = data.replace(/\t/g, ' ');
                            var res = data.split(" ");
							for (var i = 0; i<res.length;i++){
								//For now only checks variables
								if (res[i] == "private"){
									//For now only supports boolean type
									if (res[i+1] == "boolean"){
										name[j] = res[i+2];
										j++;
									}
								}
							}
							addRadioBool(name);
							
					}                   
                });
			
});
</script>
</head>
<body>
<h1> Prototype - Configuration Duckietown </h1>
<select id="mods" name="modules">
	<option value="Camera">Camera</option>
</select>
<br><button id="btn_ros2java" onclick="parsetoJava()">ROS to Java</button><br><br>
<button id="btn_java2ros" onclick="parsetoROS()">Java to ROS</button>
</body>
</html> 